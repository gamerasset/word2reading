<view class="container">
  <view class="title-wrapper">
    <image class="logo" src="/assets/logo.png" mode="aspectFit"></image>
    <view class="title">单词生成阅读</view>
    <view class="subtitle">请输入 3-5 个 KET/PET/FCE 单词</view>
    <view class="dictionary-status" wx:if="{{!isDictionaryLoaded}}">
      <text class="status-text">词典加载中...</text>
    </view>
    <view class="dictionary-status success" wx:if="{{isDictionaryLoaded}}">
      <text class="status-text">✓ 词典已就绪</text>
    </view>
  </view>

  <view class="form-wrapper">
    <!-- 使用 wx:for 循环渲染输入框 -->
    <view class="input-group" wx:for="{{inputs}}" wx:key="index">
      <input 
        class="word-input {{item.error ? 'input-error' : ''}}" 
        placeholder="{{item.placeholder}}"
        value="{{item.value}}"
        data-index="{{index}}"
        bindblur="onWordBlur"
      />
      <!-- 显示翻译或错误信息 -->
      <view class="result-text translation" wx:if="{{item.translation}}">{{item.translation}}</view>
      <view class="result-text error" wx:if="{{item.error}}">{{item.error}}</view>
    </view>
  </view>

  <view class="button-wrapper">
    <button 
      class="generate-btn" 
      disabled="{{isButtonDisabled}}"
      loading="{{isLoading}}"
      bindtap="onGenerateClick"
    >
      生成短文
    </button>
  </view>

  <!-- 结果展示区域 -->
  <view class="result-container" wx:if="{{showResult}}">
    <!-- 文章区域 -->
    <view class="article-wrapper">
      <view class="article-header">
        <view class="article-title">📖 阅读文章</view>
        <view class="difficulty-badge" wx:if="{{level}}">{{level}}</view>
      </view>
      <view class="article-content">{{article}}</view>
    </view>

    <!-- 问题区域 -->
    <view class="questions-wrapper">
      <view class="questions-title">📝 选择题 ({{questions.length}}题)</view>
      
      <view class="question-item" wx:for="{{questions}}" wx:key="questionIndex">
        <view class="question-header">
          <text class="question-number">第{{index + 1}}题</text>
          <view class="question-status" wx:if="{{showAnswers}}">
            <text class="status-icon {{item.isCorrect ? 'correct' : 'incorrect'}}">
              {{item.isCorrect ? '✓' : '✗'}}
            </text>
          </view>
        </view>
        
        <view class="question-text">{{item.question}}</view>
        
        <view class="options-wrapper">
          <view 
            class="option-item {{item.userAnswer === option.key ? 'selected' : ''}} {{showAnswers && option.isCorrect ? 'correct-answer' : ''}} {{showAnswers && item.userAnswer === option.key && !item.isCorrect ? 'wrong-answer' : ''}}"
            wx:for="{{item.options}}" 
            wx:for-item="option" 
            wx:key="key"
            data-question-index="{{item.questionIndex}}"
            data-option-key="{{option.key}}"
            bindtap="onAnswerSelect"
          >
            <view class="option-label">{{option.key}}</view>
            <view class="option-text">{{option.text}}</view>
            <view class="option-indicator" wx:if="{{showAnswers && option.isCorrect}}">
              <text class="correct-mark">✓</text>
            </view>
          </view>
        </view>
        
        <!-- 答案解析 -->
        <view class="explanation" wx:if="{{showAnswers}}">
          <view class="explanation-title">💡 解析</view>
          <view class="explanation-text">{{item.explanation}}</view>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button 
        class="submit-btn" 
        wx:if="{{!showAnswers}}"
        bindtap="onSubmitAnswers"
      >
        提交答案
      </button>
      
      <view class="result-summary" wx:if="{{showAnswers}}">
        <view class="score-display">
          <text class="score-text">得分：{{score}}/{{totalQuestions}}</text>
          <text class="score-percentage">({{scorePercentage}}%)</text>
        </view>
        <button class="restart-btn" bindtap="onRestart">重新开始</button>
      </view>
    </view>
  </view>
</view>